<!doctype html>
<html lang="ja">
<head>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%236ba8ff'/%3E%3Ctext x='50%25' y='54%25' text-anchor='middle' font-size='38' font-family='sans-serif' fill='%230b0d12'%3EPT%3C/text%3E%3C/svg%3E">
  <meta charset="utf-8">
  <title>今年の進捗トラッカー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="目標と日々のタスクを可視化。テンプレ保存・バックアップ・結果カード・シェア文作成に対応。">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="wrap header">
    <div class="brand">
      <div class="logo">PT</div>
      <div>
        <h1>今年の進捗トラッカー</h1>
        <p class="muted">ローカル保存 / GitHub Pages 対応</p>
      </div>
    </div>
    <nav class="nav">
      <a href="#profile">目標</a>
      <a href="#tasks">タスク</a>
      <a href="#records">記録</a>
      <a href="#charts">可視化</a>
      <a href="#challenge">チャレンジ</a>
      <a href="#backup">バックアップ</a>
    </nav>
  </header>

  <main class="wrap">

    <!-- 1. 目標設定 -->
    <section id="profile">
      <h2>1. 目標の設定</h2>
      <div class="grid">
        <label>目標タイトル
          <input id="goalTitle" type="text" placeholder="例：体重を◯kgに／英単語◯語学習 など">
        </label>
        <label>開始日
          <input id="startDate" type="date">
        </label>
        <label>目標値（数値）
          <input id="goalValue" type="number" step="0.01" min="0">
        </label>
        <label>単位（自由入力）
          <input id="unit" type="text" placeholder="kg / 回 / 語 / km…">
        </label>
        <label>到達条件
          <select id="goalDir">
            <option value="gte">以上で達成（例：貯金100万円以上）</option>
            <option value="lte">以下で達成（例：体重75kg以下）</option>
          </select>
        </label>
      </div>
      <label>目標のメモ
        <textarea id="goalDesc" rows="2" placeholder="健康維持のために など"></textarea>
      </label>
      <div class="row">
        <button class="btn primary" id="saveProfile" type="button">保存</button>
        <span class="muted" id="profileSaved"></span>
      </div>
    </section>

    <!-- 2. タスク定義 -->
    <section id="tasks">
      <h2>2. 日々のタスク定義</h2>
      <p class="muted">重要度：S/A/B/C/D、任意で1日の目標回数（target）を設定</p>
      <div id="taskList" class="card"></div>
      <div class="row">
        <button class="btn" id="addTask" type="button">＋ タスクを追加</button>
      </div>
      <details class="card">
        <summary>重要度の重み（上級者向け）</summary>
        <div id="weightEditor" class="grid narrow"></div>
      </details>
      <div class="row">
        <button class="btn" id="downloadTemplate" type="button">テンプレートをダウンロード（設定のみ）</button>
        <label class="filelike">
          テンプレートを読み込む
          <input id="uploadTemplate" type="file" accept="application/json" hidden>
        </label>
      </div>
    </section>

    <!-- 3. 日々の記録 -->
    <section id="records">
      <h2>3. 日々のタスク結果入力</h2>

      <!-- 目標の推移 -->
      <div class="card">
        <div class="row">
          <label>日付 <input id="recDate" type="date"></label>
          <button class="btn" id="copyPrev" type="button">前日コピー</button>
          <button class="btn ghost" id="clearToday" type="button">今日をクリア</button>
        </div>
        <div class="grid">
          <label>※目標の現在値（推移）
            <input id="goalProgress" type="number" step="0.01" placeholder="例：本日の体重など">
          </label>
          <div class="help muted">投稿文やチャレンジ結果で使用します（任意）</div>
        </div>
      </div>

      <!-- タスク実績 -->
      <div id="recordInputs" class="card"></div>

      <div class="row">
        <button class="btn primary" id="saveRecord" type="button">今日の記録を保存</button>
        <span id="recordSaved" class="muted"></span>
      </div>
    </section>

    <!-- 4. 可視化 -->
    <section id="charts">
      <h2>4. 可視化</h2>
      <div class="row">
        <button data-days="30" class="btn chip chartRange is-active" type="button">直近30日</button>
        <button data-days="100" class="btn chip chartRange" type="button">直近100日</button>
      </div>
      <div class="card">
        <!-- 高さ 180 に縮小、幅はCSSで100% -->
        <canvas id="dailyChart" height="180" aria-label="日次達成率グラフ"></canvas>
        <p class="muted small">グラフは各日の<strong>加重達成率</strong>（0〜100%）。</p>
      </div>

      <div class="row">
        <button class="btn" id="makeCard" type="button">画像作成</button>
        <a class="btn" id="dlCard" download="result-card.png">画像ダウンロード</a>
        <button class="btn accent" id="postDaily" type="button">Xに投稿（今日の進捗）</button>
      </div>
      <div class="cardPreview">
        <canvas id="resultCard" width="1080" height="1350"></canvas>
      </div>
    </section>

    <!-- 5. チャレンジ -->
    <section id="challenge">
      <h2>5. 30日 / 100日チャレンジ</h2>
      <div class="row">
        <label>開始日 <input id="challengeStart" type="date"></label>
        <button class="btn" id="calc30" type="button">30日集計</button>
        <button class="btn" id="calc100" type="button">100日集計</button>
        <button class="btn accent" id="postChallenge" type="button">Xに投稿（結果）</button>
      </div>
      <div id="challengeResult" class="cards"></div>
    </section>

    <!-- 6. バックアップ -->
    <section id="backup">
      <h2>6. バックアップ/復元</h2>
      <div class="row">
        <button class="btn" id="downloadBackup" type="button">バックアップをダウンロード（全データ）</button>
        <label class="filelike">
          バックアップから復元（上書き）
          <input id="uploadBackup" type="file" accept="application/json" hidden>
        </label>
      </div>
    </section>

  </main>

  <footer class="wrap muted small footer">
    <p>保存先：この端末の <code>localStorage</code>（外部送信なし）。定期的にバックアップJSONのダウンロード推奨。</p>
  </footer>

  <script src="js/app.js"></script>
</body>
</html>
